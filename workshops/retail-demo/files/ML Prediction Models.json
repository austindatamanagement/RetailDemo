{"paragraphs":[{"title":"Prepare Tables ","text":"%script\n-- Drop Tables\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table transaction_values';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table item_store_sale_per_day';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table stores_zip_census';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n\n-- Create Tables\ncreate table transaction_values as \n            (select  transaction_id, sum(quantity*item_price) as total_txn_price, store_id, TO_CHAR(cast(date_of_sale as date), 'D') as day_of_week, date_of_sale\n                from developer.transaction_history group by transaction_id, store_id, date_of_sale);\nalter table transaction_values add id number(16,0);\nupdate transaction_values set id = rownum;\n\ncreate table item_store_sale_per_day as \n            (select product_id, store_id, sum(quantity) as sold_count, sum(quantity*item_price) as sold_value, EXTRACT(HOUR from date_of_sale) as hour_of_sale, date_of_sale as sale_date \n            from developer.transaction_history group by product_id, store_id, EXTRACT(HOUR from date_of_sale), date_of_sale);\nalter table item_store_sale_per_day add day_of_week char;\nupdate item_store_sale_per_day set day_of_week = TO_CHAR(cast(sale_date as date), 'D');\n\ncreate table stores_zip_census as \n            (select c.zip, c.state, c.county, sum(c.totalpop) as totalpop, sum(c.men) as men, sum(c.women) as women, round(avg(c.hispanic),2) as hispanic, round(avg(c.white),2) as white, round(avg(c.black),2) as black, round(avg(c.native),2) as native, round(avg(c.asian),2) as asian, round(avg(c.pacific),2) pacific, round(avg(c.income),2) as income, round(avg(c.incomeerr),2) as incomeerr, round(avg(c.incomepercap),2) incomepercap, round(avg(c.poverty),2) as poverty, round(avg(c.childpoverty),2) as childpoverty, sum(c.employed) as employed, round(avg(c.unemployment),2) as unemployment, round(avg(c.meancommute),2) as meancommute, round(avg(c.drive),2) as drive , round(avg(c.selfemployed),2) as selfemployed\n            from developer.us_census c inner join developer.OOW_DEMO_stores s on c.zip = s.store_zip \n            group by c.zip, c.state, c.county);\n","user":"TESTUSER","dateUpdated":"2019-12-16T17:47:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","tableHide":false,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable TRANSACTION_VALUES created.\n\n\n---------------------------\n\nTable TRANSACTION_VALUES altered.\n\n\n---------------------------\n\n219,205 rows updated.\n\n\n---------------------------\n\nTable ITEM_STORE_SALE_PER_DAY created.\n\n\n---------------------------\n\nTable ITEM_STORE_SALE_PER_DAY altered.\n\n\n---------------------------\n\n381,243 rows updated.\n\n\n---------------------------\n\nTable STORES_ZIP_CENSUS created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_134903464","id":"20191216-172323_301087791","dateCreated":"2019-12-02T20:37:14+0000","dateStarted":"2019-12-16T17:47:55+0000","dateFinished":"2019-12-16T17:48:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"focus":true,"$$hashKey":"object:144"},{"title":"Create Tables for ML Models","text":"%script\n-- Drop the existing tables\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_txn_sale';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n-- Create tables\ncreate table detailed_item_store_sale as \n     (select spd.product_id, spd.store_id, spd.sold_count, spd.sale_date, spd.hour_of_sale, spd.day_of_week, s.store_type, s.store_city, s.region_id, s.n1, s.n2, s.n3, s.n4, i.type, i.msrp, c.*\n        from item_store_sale_per_day spd \n            inner join developer.OOW_DEMO_stores s on spd.store_id = s.id \n            inner join developer.OOW_DEMO_items i on spd.product_id = i.id\n            inner join stores_zip_census c on s.store_zip = c.zip);\n            \n    \ncreate table detailed_txn_sale as \n     (select t.id, t.transaction_id, t.total_txn_price, t.day_of_week, s.store_type, s.store_city, s.region_id, c.totalpop as total_population, c.men as gender_male, c.unemployment, c.income, c.poverty, c.white as ethnicity_white, c.employed as employment\n        from transaction_values t \n            inner join developer.OOW_DEMO_stores s on t.store_id = s.id \n            inner join stores_zip_census c on s.store_zip = c.zip) ;\n            \n             \n","user":"TESTUSER","dateUpdated":"2019-12-16T17:49:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable DETAILED_ITEM_STORE_SALE created.\n\n\n---------------------------\n\nTable DETAILED_TXN_SALE created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_1418321656","id":"20191216-172323_648419610","dateCreated":"2019-08-13T18:33:04+0000","dateStarted":"2019-12-16T17:49:17+0000","dateFinished":"2019-12-16T17:49:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:145"},{"title":"Attribute Importance Model","text":"The goal in the next section is to identify key attributes that have the most influence on a target attribute (Total Transaction Value). We build an Attribute Importance model (minimum desciption length algorithm) using the Sales History and Us_Census data all performed inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER","dateUpdated":"2019-11-21T17:26:28+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","lineNumbers":false,"title":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576517003768_1602665541","id":"20191216-172323_606126894","dateCreated":"2019-08-20T18:04:58+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:146"},{"title":"Build an Attribute Importance Model for Sales in Different Stores","text":"%script\n\n/*  Find the importance of attributes that independently impact the target attribute:   total_txn_price  */\n\nDECLARE\nv_sql varchar2(100);\n\nBEGIN\n\nBEGIN EXECUTE IMMEDIATE 'DROP TABLE txn_sale_ai_explain_output';\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n\nBEGIN\n  DBMS_PREDICTIVE_ANALYTICS.EXPLAIN(\n    data_table_name     => 'detailed_txn_sale',\n    explain_column_name => 'total_txn_price',\n    result_table_name   => 'txn_sale_ai_explain_output');\nEND;\n\nEnd;","user":"TESTUSER","dateUpdated":"2019-12-16T17:49:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_1904142357","id":"20191216-172323_1130603290","dateCreated":"2019-08-13T18:54:42+0000","dateStarted":"2019-12-16T17:49:29+0000","dateFinished":"2019-12-16T17:49:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:147"},{"title":"Best Store Location Prediction Model","text":"Next section builds a predictiive model by using the top 5 most important attributes that influence total sales value in each store to predict the best locations for openning new store branches based on the demographic data across the US. The model is a generalized linear regression model which is trained and applied inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER","dateUpdated":"2019-11-21T17:26:30+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","lineNumbers":false,"title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576517003768_706746762","id":"20191216-172323_1139862557","dateCreated":"2019-08-20T18:16:36+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:148"},{"title":"Create Tables for Store Location Prediction","text":"%script\n-- Drop Tables\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table total_txn_per_store';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table us_census_important_attributes';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table best_zip_training';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table zip_important_attributes';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\ncreate table total_txn_per_store as (select sum(total_txn_price) as total_txn_value, store_id from transaction_values group by store_id);\n\ncreate table us_census_important_attributes as \n            (select c.zip, c.state, round(avg(c.unemployment),2) as unemployment, round(avg(c.white),2) as ETHNICITY_white, round(avg(c.income),2) as income, round(avg(c.poverty),2) as poverty, sum(c.men) as gender_male from developer.us_census c where c.zip is not null group by c.zip, c.state);\n            \ncreate table best_zip_training as \n            (select c.zip, c.unemployment, c.ETHNICITY_white, c.income, c.poverty, c.gender_male, t.total_txn_value\n             from developer.OOW_DEMO_stores s \n             inner join us_census_important_attributes c on s.store_zip = c.zip\n             inner join total_txn_per_store t on t.store_id = s.id);\n             \ncreate table zip_important_attributes as \n            (select c.zip, c.unemployment, c.ETHNICITY_white, c.income, c.poverty, c.gender_male from us_census_important_attributes c \n             where c.zip not in (select unique(s.store_zip) from developer.OOW_DEMO_stores s) and c.zip > 9999);\n\n","user":"TESTUSER","dateUpdated":"2019-12-16T17:50:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","tableHide":true,"title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable TOTAL_TXN_PER_STORE created.\n\n\n---------------------------\n\nTable US_CENSUS_IMPORTANT_ATTRIBUTES created.\n\n\n---------------------------\n\nTable BEST_ZIP_TRAINING created.\n\n\n---------------------------\n\nTable ZIP_IMPORTANT_ATTRIBUTES created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-385410308","id":"20191216-172323_1434993584","dateCreated":"2019-08-16T17:55:20+0000","dateStarted":"2019-12-16T17:50:12+0000","dateFinished":"2019-12-16T17:50:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:149"},{"title":"Preparing GLM Model Feature Selection for Store Location Prediction","text":"%script\n\n/*  Clean up any previous GLM Models for notebook repeatability  */\nBEGIN\n  DBMS_DATA_MINING.DROP_MODEL('GLMR_location_prediction_Regr');\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n/\n\n/*  Clean up and drop any previous GLM Model Settings table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_location_prediction_Regr_settings';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/*  Clean up and drop any previous Model Diagnostics table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_location_prediction_Regr_diag';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/* Create GLM Model Settings table */\nCREATE TABLE GLMR_location_prediction_Regr_settings (setting_name  VARCHAR2(30), setting_value VARCHAR2(4000));\n/\n\n \nBEGIN \n/* Populate settings table  */\n  INSERT INTO GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.algo_name, dbms_data_mining.algo_generalized_linear_model);\n  -- output row diagnostic statistics into a table named GLMC_SH_SAMPLE_DIAG  \n  INSERT INTO  GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.glms_diagnostics_table_name, 'GLMR_SH_SAMPLE_DIAG');  \n  INSERT INTO  GLMR_location_prediction_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.prep_auto, dbms_data_mining.prep_auto_on);  \nEND;","user":"TESTUSER","dateUpdated":"2019-12-16T17:50:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable GLMR_LOCATION_PREDICTION_REGR_SETTINGS created.\n\n\n---------------------------\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_1404092698","id":"20191216-172323_2006172572","dateCreated":"2019-08-20T01:38:58+0000","dateStarted":"2019-12-16T17:50:25+0000","dateFinished":"2019-12-16T17:50:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:150"},{"title":"Build the Store Prediction Model","text":"%script\n\ndeclare\n  v_xlst dbms_data_mining_transform.TRANSFORM_LIST;\n \nBEGIN\n  DBMS_DATA_MINING.CREATE_MODEL(\n    model_name          => 'GLMR_location_prediction_Regr',\n    mining_function     => dbms_data_mining.regression,\n    data_table_name     => 'best_zip_training',\n    case_id_column_name => 'zip',\n    target_column_name  => 'total_txn_value',\n    settings_table_name => 'GLMR_location_prediction_Regr_settings',\n    xform_list          => v_xlst);\nEND;","user":"TESTUSER","dateUpdated":"2019-12-16T17:50:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_-1877780489","id":"20191216-172323_691455239","dateCreated":"2019-08-20T01:41:54+0000","dateStarted":"2019-12-16T17:50:29+0000","dateFinished":"2019-12-16T17:50:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:151"},{"title":"Prediction (Store Location Model)","text":"%script\n/* Drop the prediction result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table txn_value_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table best_store_locations';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.top_ten_store_locations';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the prediction result table*/\nCREATE TABLE txn_value_prediction\n( zip number,\n  PREDICTED_txn_value NUMBER\n);\n\n/* apply the ML model on the prediction set, store the data in the prediction result table*/\nInsert into txn_value_prediction (zip, PREDICTED_txn_value)\n        select zip, PREDICTION(GLMR_location_prediction_Regr USING *) pr \n        from zip_important_attributes;\n        \ncreate table best_store_locations as \n        (select rank() over (order by t.PREDICTED_txn_value desc) rank, c.state, t.* from txn_value_prediction t join us_census_important_attributes c on t.zip = c.zip);\n        \ncreate table developer.top_ten_store_locations as \n        (select * from best_store_locations where rank < 11);\n        ","user":"TESTUSER","dateUpdated":"2019-12-16T17:50:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable TXN_VALUE_PREDICTION created.\n\n\n---------------------------\n\n36,204 rows inserted.\n\n\n---------------------------\n\nTable BEST_STORE_LOCATIONS created.\n\n\n---------------------------\n\nTable DEVELOPER.TOP_TEN_STORE_LOCATIONS created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-1968991985","id":"20191216-172323_1835156536","dateCreated":"2019-08-20T01:43:46+0000","dateStarted":"2019-12-16T17:50:50+0000","dateFinished":"2019-12-16T17:50:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:152"},{"title":"Item Sale Prediction Model","text":"Next section builds a model to predict the sale quantity of each item in each store in the upcoming week by considering the sales history over the past month. The model is a generalized linear regression model which is trained and applied inside the Oracle Autonomous Data Warehouse Cloud (ADWC).","user":"TESTUSER","dateUpdated":"2019-11-21T17:26:33+0000","config":{"colWidth":10,"enabled":false,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","lineNumbers":false,"title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576517003768_-2143659591","id":"20191216-172323_2061508583","dateCreated":"2019-08-20T18:22:23+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:153"},{"title":"Create Training and Test Sets for Item Sale Prediction ","text":"%script\n/* Drop exisiting tables*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_train';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_test';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table detailed_item_store_sale_predict';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* Divide the datset to traing and test sets (80-20)*/\ncreate table detailed_item_store_sale_train as (select * from detailed_item_store_sale where to_date(to_char(sale_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') < to_date('2019-07-31', 'YYYY-MM-DD'));\ncreate table detailed_item_store_sale_test as (select * from detailed_item_store_sale where to_date(to_char(sale_date, 'YYYY-MM-DD'), 'YYYY-MM-DD') > to_date('2019-07-30', 'YYYY-MM-DD'));\n\ncreate table detailed_item_store_sale_predict as (select * from detailed_item_store_sale_test);\nalter table detailed_item_store_sale_predict drop column sold_count;\nupdate detailed_item_store_sale_predict set sale_date = sale_date+32;\n\n","user":"TESTUSER","dateUpdated":"2019-12-16T17:51:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable DETAILED_ITEM_STORE_SALE_TRAIN created.\n\n\n---------------------------\n\nTable DETAILED_ITEM_STORE_SALE_TEST created.\n\n\n---------------------------\n\nTable DETAILED_ITEM_STORE_SALE_PREDICT created.\n\n\n---------------------------\n\nTable DETAILED_ITEM_STORE_SALE_PREDICT altered.\n\n\n---------------------------\n\n75,095 rows updated.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_1014747114","id":"20191216-172323_327597060","dateCreated":"2019-08-15T17:05:55+0000","dateStarted":"2019-12-16T17:51:13+0000","dateFinished":"2019-12-16T17:51:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:154"},{"title":"Preparing GLM Model Feature Selection for Item Sale Prediction","text":"%script\n\n/*  Clean up any previous GLM Models for notebook repeatability  */\nBEGIN\n  DBMS_DATA_MINING.DROP_MODEL('GLMR_soldItem_Regr');\nEXCEPTION WHEN OTHERS THEN NULL; \nEND;\n/\n\n/*  Clean up and drop any previous GLM Model Settings table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_soldItem_Regr_settings';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/*  Clean up and drop any previous Model Diagnostics table for notebook repeatability  */ \nBEGIN EXECUTE IMMEDIATE 'DROP TABLE GLMR_soldItem_Regr_diag';\nEXCEPTION WHEN OTHERS THEN NULL; END;\n/\n\n/* Create GLM Model Settings table */\nCREATE TABLE GLMR_soldItem_Regr_settings (setting_name  VARCHAR2(30), setting_value VARCHAR2(4000));\n/\n\n \nBEGIN \n/* Populate settings table  */\n  INSERT INTO GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.algo_name, dbms_data_mining.algo_generalized_linear_model);\n  -- output row diagnostic statistics into a table named GLMC_SH_SAMPLE_DIAG  \n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.glms_diagnostics_table_name, 'GLMR_SH_SAMPLE_DIAG');  \n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES\n    (dbms_data_mining.prep_auto, dbms_data_mining.prep_auto_on);  \n  -- turn on feature selection\n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES  \n    (dbms_data_mining.glms_ftr_selection, \n    dbms_data_mining.glms_ftr_selection_enable);\n  -- turn on feature generation\n  INSERT INTO  GLMR_soldItem_Regr_settings (setting_name, setting_value) VALUES \n    (dbms_data_mining.glms_ftr_generation, \n    dbms_data_mining.glms_ftr_generation_enable); \nEND;","user":"TESTUSER","dateUpdated":"2019-12-16T17:51:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable GLMR_SOLDITEM_REGR_SETTINGS created.\n\n\n---------------------------\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_1480274235","id":"20191216-172323_210193806","dateCreated":"2019-08-14T18:55:33+0000","dateStarted":"2019-12-16T17:51:31+0000","dateFinished":"2019-12-16T17:51:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:155"},{"title":"Build the GLM Regression Model for Item Sale Prediction","text":"%script\n\ndeclare\n  v_xlst dbms_data_mining_transform.TRANSFORM_LIST;\n \nBEGIN\n  DBMS_DATA_MINING.CREATE_MODEL(\n    model_name          => 'GLMR_soldItem_Regr',\n    mining_function     => dbms_data_mining.regression,\n    data_table_name     => 'detailed_item_store_sale_train',\n    case_id_column_name => 'sale_date',\n    target_column_name  => 'sold_count',\n    settings_table_name => 'GLMR_soldItem_Regr_settings',\n    xform_list          => v_xlst);\nEND;","user":"TESTUSER","dateUpdated":"2019-12-16T17:51:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_-1875959519","id":"20191216-172323_1941674914","dateCreated":"2019-08-14T19:53:26+0000","dateStarted":"2019-12-16T17:51:35+0000","dateFinished":"2019-12-16T18:02:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:156"},{"title":"Validation (Item Sale Prediction Model)","text":"%script\n/* Drop the validation result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_validation';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the validation result table*/\nCREATE TABLE Item_sold_validation\n( sale_date TIMESTAMP,\n  store_id NUMBER,\n  product_id NUMBER,\n  hour_of_sale NUMBER,\n  ACTUAL_sold_count NUMBER,\n  PREDICTED_sold_count NUMBER\n);\n\n/* apply the ML model on the test set for validation, store the data in the validation result table*/\nInsert into Item_sold_validation (sale_date, store_id, product_id, hour_of_sale, ACTUAL_sold_count, PREDICTED_sold_count)\n        select sale_date, store_id, product_id, hour_of_sale, sold_count, PREDICTION(GLMR_soldItem_Regr USING *) pr \n        from detailed_item_store_sale_test;","user":"TESTUSER","dateUpdated":"2019-12-16T18:09:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable ITEM_SOLD_VALIDATION created.\n\n\n---------------------------\n\n75,095 rows inserted.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-255562984","id":"20191216-172323_790517430","dateCreated":"2019-08-15T17:25:54+0000","dateStarted":"2019-12-16T18:09:46+0000","dateFinished":"2019-12-16T18:09:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:158"},{"title":"Prediction (Item Sale Prediction Model)","text":"%script\n/* Drop the prediction result table*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table Item_sold_prediction_next_week';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the prediction result table*/\nCREATE TABLE Item_sold_prediction\n( sale_date TIMESTAMP,\n  store_id NUMBER,\n  product_id NUMBER,\n  hour_of_sale NUMBER,\n  PREDICTED_sold_count NUMBER\n);\n\n\n/* apply the ML model on the prediction set, store the data in the prediction result table*/\nInsert into Item_sold_prediction (sale_date, store_id, product_id, hour_of_sale, PREDICTED_sold_count)\n        select sale_date, store_id, product_id, hour_of_sale, PREDICTION(GLMR_soldItem_Regr USING *) pr \n        from detailed_item_store_sale_predict;\n        \ncreate table Item_sold_prediction_next_week as (select sum(PREDICTED_sold_count) as sale_prediction, store_id, product_id from Item_sold_prediction group by store_id, product_id);","user":"TESTUSER","dateUpdated":"2019-12-16T18:09:51+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable ITEM_SOLD_PREDICTION created.\n\n\n---------------------------\n\n75,095 rows inserted.\n\n\n---------------------------\n\nTable ITEM_SOLD_PREDICTION_NEXT_WEEK created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-130864929","id":"20191216-172323_423855590","dateCreated":"2019-08-15T21:48:14+0000","dateStarted":"2019-12-16T18:09:51+0000","dateFinished":"2019-12-16T18:09:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:159"},{"title":"Transfer Result Tables to the Developer's Schema for Visualization","text":"%script\n/* Drop exisiting tables in the Developer's space*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_validation';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_prediction';\n        EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.Item_sold_prediction_next_week';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n\n/* copy ML result tables to Developer's space*/\ncreate table developer.Item_sold_validation as (select * from Item_sold_validation);\ncreate table developer.Item_sold_prediction as (select * from Item_sold_prediction);\ncreate table developer.Item_sold_prediction_next_week as (select * from Item_sold_prediction_next_week);\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:09:56+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable DEVELOPER.ITEM_SOLD_VALIDATION created.\n\n\n---------------------------\n\nTable DEVELOPER.ITEM_SOLD_PREDICTION created.\n\n\n---------------------------\n\nTable DEVELOPER.ITEM_SOLD_PREDICTION_NEXT_WEEK created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-7884420","id":"20191216-172323_906656743","dateCreated":"2019-08-12T19:37:20+0000","dateStarted":"2019-12-16T18:09:56+0000","dateFinished":"2019-12-16T18:09:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:160"},{"title":"Anomaly Detection to Find Suspicious Transactions","text":"The next section shows how to detect rare transactions using an unsupervised learning algorithm (1-Class Support Vector Machine). The notebook first builds a 1-Class SVM model and then applies the model to flag unusual or suspicious transactions. The anomaly detection model can also be applied to detect new suspicious transactions. The entire machine learning methodology runs inside the Oracle Autonomous Data Warehouse Cloud (ADWC).\n","user":"TESTUSER","dateUpdated":"2019-11-21T17:26:38+0000","config":{"colWidth":9,"enabled":false,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576517003768_-826071062","id":"20191216-172323_1245728294","dateCreated":"2019-08-20T18:39:48+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:161"},{"title":"Build Anomaly Detection Model (1-Class SVM)","text":"%script\n\n/*  Build Anomaly Detection Model (1-Class SVM) on detailed_txn_sale data  */\n\nDECLARE\nv_sql varchar2(100);\n\nBEGIN\n\n/*  drop build settings  */\nBEGIN\nv_sql := 'DROP TABLE detailed_txn_sale_SET';\nEXECUTE IMMEDIATE v_sql;\nDBMS_OUTPUT.PUT_LINE (v_sql ||': succeeded');\nEXCEPTION\nWHEN OTHERS THEN\nDBMS_OUTPUT.PUT_LINE (v_sql ||': drop unneccessary - no table exists');\nEND;\n\n/*  drop any previous model.  */\nBEGIN\nv_sql := 'CALL DBMS_DATA_MINING.DROP_MODEL(''detailed_txn_sale_MODEL'')';\nEXECUTE IMMEDIATE v_sql;\nDBMS_OUTPUT.PUT_LINE (v_sql ||': succeeded');\nEXCEPTION\nWHEN OTHERS THEN\nDBMS_OUTPUT.PUT_LINE (v_sql ||': drop unneccessary - no model exists');\nEND;\n\n\n/*  Create a Build Setting table for Model Build  */\n\nEXECUTE IMMEDIATE 'CREATE TABLE detailed_txn_sale_SET (setting_name VARCHAR2(30),setting_value VARCHAR2(4000))';\nEXECUTE IMMEDIATE 'INSERT INTO detailed_txn_sale_SET (setting_name, setting_value) VALUES (''ALGO_NAME'', ''ALGO_SUPPORT_VECTOR_MACHINES'')';\nEXECUTE IMMEDIATE 'INSERT INTO detailed_txn_sale_SET (setting_name, setting_value) VALUES (''PREP_AUTO'', ''ON'')';\nDBMS_OUTPUT.PUT_LINE ('Created model build settings table: detailed_txn_sale_SET ');\n\n\n/*  Build the 1-Class SVM model.  */\n\nEXECUTE IMMEDIATE 'CALL DBMS_DATA_MINING.CREATE_MODEL(''detailed_txn_sale_MODEL'', ''CLASSIFICATION'', ''detailed_txn_sale'', ''transaction_id'', null, ''detailed_txn_sale_SET'')';\nDBMS_OUTPUT.PUT_LINE ('Created model: detailed_txn_sale_MODEL');\n\nEnd;\n\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DROP TABLE detailed_txn_sale_SET: succeeded\nCALL DBMS_DATA_MINING.DROP_MODEL('detailed_txn_sale_MODEL'): drop unneccessary -\nno model exists\nCreated model build settings table: detailed_txn_sale_SET \nCreated model: detailed_txn_sale_MODEL\n\n\nPL/SQL procedure successfully completed.\n\n"}]},"jobName":"paragraph_1576517003768_549614173","id":"20191216-172323_389421630","dateCreated":"2019-08-13T19:29:59+0000","dateStarted":"2019-12-16T18:10:19+0000","dateFinished":"2019-12-16T18:10:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:162"},{"title":"Calculate the Probability of Transactions Being Anomalous","text":"%script\n/* drop the result table */\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table anomalous_transactions';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* create the result table*/ \ncreate table anomalous_transactions as \n(select id, transaction_id, total_txn_price, round(prob_fraud*100,2) percent_fraud,\n      rank() over (order by prob_fraud desc) rnk from\n(select id, transaction_id, total_txn_price, prediction_probability(detailed_txn_sale_MODEL, '0' using *) prob_fraud\nfrom detailed_txn_sale\n));\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable ANOMALOUS_TRANSACTIONS created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_-1170834479","id":"20191216-172323_316653963","dateCreated":"2019-08-20T00:56:24+0000","dateStarted":"2019-12-16T18:10:34+0000","dateFinished":"2019-12-16T18:10:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:163"},{"title":"Display the Top 3 Transactions in Probability of Being Anomalous in Descending Order","text":"%sql\nSELECT at.rnk, at.id, at.transaction_id, tv.store_id, tv.date_of_sale, at.total_txn_price, at.percent_fraud FROM anomalous_transactions at join transaction_values tv on at.id = tv.id where at.rnk <= 3 order by at.percent_fraud desc;\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"RNK\tID\tTRANSACTION_ID\tSTORE_ID\tDATE_OF_SALE\tTOTAL_TXN_PRICE\tPERCENT_FRAUD\n1\t14228\t20190721-3_2\t8\t2019-08-02 08:19:00\t593.85\t55.86\n2\t2065\t20190726-40_5\t8\t2019-07-06 01:50:00\t527.36\t55.67\n3\t1466\t20190804-18_1\t8\t2019-07-04 14:49:00\t496.85\t55.48\n"}]},"jobName":"paragraph_1576517003768_-574049920","id":"20191216-172323_2012169588","dateCreated":"2019-08-20T18:02:23+0000","dateStarted":"2019-12-16T18:10:42+0000","dateFinished":"2019-12-16T18:10:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:164"},{"title":"Transfer Result Tables to the Developer's Schema","text":"%script\n/* Drop exisiting tables in the Developer's space*/\nBEGIN\n      EXECUTE IMMEDIATE 'DROP Table developer.anomalous_transactions';\n  EXCEPTION\n      WHEN OTHERS THEN NULL;\nEND;\n/\n\n/* copy ML result tables to Developer's space*/\ncreate table developer.anomalous_transactions as (SELECT t.rnk, t.id, t.transaction_id, tv.store_id, tv.date_of_sale, t.total_txn_price, t.percent_fraud FROM anomalous_transactions t join transaction_values tv on t.id = tv.id where t.rnk <= 3);\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","title":true,"tableHide":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable DEVELOPER.ANOMALOUS_TRANSACTIONS created.\n\n\n---------------------------\n"}]},"jobName":"paragraph_1576517003768_21050343","id":"20191216-172323_1058407633","dateCreated":"2019-08-20T18:13:47+0000","dateStarted":"2019-12-16T18:10:44+0000","dateFinished":"2019-12-16T18:10:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:165"},{"text":"%script\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576517003768_1349508279","id":"20191216-172323_408297191","dateCreated":"2019-11-21T17:32:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":false,"$$hashKey":"object:166","errorMessage":""},{"text":"%script\n","user":"TESTUSER","dateUpdated":"2019-12-16T18:10:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/osql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1576519847432_-1080763610","id":"20191216-181047_970963312","dateCreated":"2019-12-16T18:10:47+0000","status":"READY","progressUpdateIntervalMs":500,"commited":false,"focus":true,"$$hashKey":"object:3580"}],"name":"ML Prediction Models","id":"480465","angularObjects":{"ORAAD84E436F6:shared_process":[],"MDW381939C745:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}